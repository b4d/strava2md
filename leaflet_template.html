 <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>
 <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin="">
</script>
<div id="plots_parent">
  <div id="map_div"></div>
  <div id="spacer"></div>
  <div id="height_profile">%(SVG_ELEV)s</div>
</div>
<style>
    #map_div { width: 656px; height: 656px; max-width: 90vw; max-height: 45vh; margin: 5px auto;}
    #height_profile { width: 656px; max-width: 90vw; max-height: 45vh; margin: 5px auto;}
    #spacer {height:5px;}
    /* Resize the Leaflet attribution text */
    .leaflet-control-attribution {
        font-size: 10px;  /* You can change this to any size you prefer */
    }
    .leaflet-control-scale-line {
        font-size: 10px;  /* Smaller font */
    }
    .leaflet-control-layers {
        font-size: 10px;        /* Change size of entire layer control */
    }
    .leaflet-control-layers label {
        font-size: 10px;        /* Size of individual map name labels */
    }
    .leaflet-control-layers-selector {
        width: 14px;            /* Optional: size of checkbox/radio */
        height: 14px;
    }
</style>
<script>
    var map = L.map('map_div');
    var OpenStreetMap_Mapnik = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
        useCache: true,
        crossOrigin: true
    });
        var OpenTopoMap = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
        maxZoom: 17,
        attribution: 'Map data: &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: &copy; <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)',
        useCache: true,
        crossOrigin: true
    });
    var SloLetalska = L.tileLayer.wms('https://ipi.eprostor.gov.si/wms-si-gurs-dts/wms',{ 
        layers: 'DOF050', 
        version:'1.3.0',
        maxZoom:19,
        attribution: '&copy; Geodetska uprava RS <a href=https://prostor4.gov.si/>gov.si</a>',
    });
    var baseMaps = {
    "OSM Mapnik": OpenStreetMap_Mapnik,
    "OpenTopoMap": OpenTopoMap,
    "Letalska": SloLetalska,
    };

    map.setView([46.4, 14.5], 9);
    L.control.layers(baseMaps).addTo(map);
    L.control.scale({ metric: true, imperial: false }).addTo(map);
    OpenStreetMap_Mapnik.addTo(map);

    var myStyle = {
    "color": "#ff7800",
    "weight": 5,
    "opacity": 0.65
    };

    var geojsonFeature = %(GEOJSON)s
    var myGeoJSONLayer = L.geoJSON(geojsonFeature, {style: myStyle}).addTo(map);
    map.fitBounds(myGeoJSONLayer.getBounds());

    // Collect all latlngs from the rendered layers (handles LineString/MultiLineString/FeatureCollection)
    function flattenLatLngs(latlngs) {
      // Leaflet returns arrays nested to indicate parts; flatten deeply
      return (Array.isArray(latlngs) ? latlngs.flat(Infinity) : [latlngs]).filter(Boolean);
    }

    var allLatLngs = [];
    myLayer.eachLayer(function (layer) {
      if (typeof layer.getLatLngs === "function") {
        allLatLngs = allLatLngs.concat(flattenLatLngs(layer.getLatLngs()));
      }
    });

    if (allLatLngs.length >= 2) {
      var start = allLatLngs[0];
      var end = allLatLngs[allLatLngs.length - 1];

      // Start: 10px diameter, 2px stroke, no fill
      L.circleMarker(start, {
        radius: 5,              // 10px diameter
        color: "#1a8e1a",       // stroke color
        weight: 2,
        fill: true,
        fillOpacity: 1
      }).addTo(map).bindPopup("Start");

      // End: 10px diameter, 2px stroke, filled
      L.circleMarker(end, {
        radius: 5,
        color: "#cc0000",
        weight: 2,
        fill: true,
        fillOpacity: 1
      }).addTo(map).bindPopup("Finish");
    } else {
      console.warn("No line coordinates found in geojsonFeature.");
    }

</script>
